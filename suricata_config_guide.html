<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<HTML>
<HEAD>
	<META HTTP-EQUIV="CONTENT-TYPE" CONTENT="text/html; charset=utf-8">
	<TITLE></TITLE>
	<META NAME="GENERATOR" CONTENT="LibreOffice 3.6  (Linux)">
	<META NAME="AUTHOR" CONTENT="Tom DeCanio">
	<META NAME="CREATED" CONTENT="20120102;16542200">
	<META NAME="CHANGEDBY" CONTENT="Tom DeCanio">
	<META NAME="CHANGED" CONTENT="20121127;14312800">
	<META NAME="CHANGEDBY" CONTENT="Tom DeCanio">
	<META NAME="CHANGEDBY" CONTENT="Tom DeCanio">
	<META NAME="CHANGEDBY" CONTENT="Tom DeCanio">
	<META NAME="CHANGEDBY" CONTENT="Tom DeCanio">
	<META NAME="CHANGEDBY" CONTENT="Tom DeCanio">
	<META NAME="CHANGEDBY" CONTENT="Tom DeCanio">
	<META NAME="CHANGEDBY" CONTENT="Tom DeCanio">
	<META NAME="CHANGEDBY" CONTENT="Tom DeCanio">
	<META NAME="CHANGEDBY" CONTENT="Tom DeCanio">
	<META NAME="CHANGEDBY" CONTENT="Tom DeCanio">
	<META NAME="CHANGEDBY" CONTENT="Tom DeCanio">
	<META NAME="CHANGEDBY" CONTENT="Tom DeCanio">
	<META NAME="CHANGEDBY" CONTENT="Tom DeCanio">
	<META NAME="CHANGEDBY" CONTENT="Tom DeCanio">
	<META NAME="CHANGEDBY" CONTENT="Tom DeCanio">
	<META NAME="CHANGEDBY" CONTENT="Tom DeCanio">
	<META NAME="CHANGEDBY" CONTENT="Tom DeCanio">
	<META NAME="CHANGEDBY" CONTENT="Tom DeCanio">
	<META NAME="CHANGEDBY" CONTENT="Tom DeCanio">
	<STYLE TYPE="text/css">
	<!--
		@page { margin: 0.79in }
		P { margin-bottom: 0.08in }
		H1.western { font-size: 20pt }
		H2.western { font-size: 16pt }
		H2.cjk { font-family: "Droid Sans" }
		H2.ctl { font-family: "Lohit Hindi" }
		H3.western { font-family: "Albany", sans-serif }
		H3.cjk { font-family: "HG Mincho Light J" }
		H3.ctl { font-family: "Arial Unicode MS" }
		PRE.cjk { font-family: "WenQuanYi Micro Hei", monospace }
		PRE.ctl { font-family: "Lohit Hindi", monospace }
		H4.western { font-family: "Albany", sans-serif; font-size: 11pt; font-style: italic }
		H4.cjk { font-family: "HG Mincho Light J"; font-size: 11pt; font-style: italic }
		H4.ctl { font-family: "Arial Unicode MS"; font-size: 11pt; font-style: italic }
		A:link { so-language: zxx }
		CODE.cjk { font-family: "WenQuanYi Micro Hei", monospace }
		CODE.ctl { font-family: "Lohit Hindi", monospace }
	-->
	</STYLE>
</HEAD>
<BODY LANG="en-US" BGCOLOR="#ffffcc" DIR="LTR">
<P STYLE="margin-bottom: 0in"><BR>
</P>
<DIV ID="wiki-content" DIR="LTR">
	<P><BR><BR>
	</P>
	<DIV ID="wiki-body" DIR="LTR">
		<P><BR><BR>
		</P>
		<DIV ID="template" DIR="LTR">
			<H1 CLASS="western"><IMG SRC="http://www.openinfosecfoundation.org/images/stories/suricata.png" NAME="graphics1" ALIGN=BOTTOM WIDTH=200 HEIGHT=166 BORDER=0>
			<FONT FACE="Arial, sans-serif">for Tilera</FONT></H1>
			<P><BR><BR>
			</P>
			<H2 CLASS="western">Suricata on Tilera</H2>
			<P>Suricata for Tilera has been modified to support Tilera's many
			core architecture. In addition the Tilera tilegx port of Suricata
			has been written to take advantage of Tilera's mpipe packet
			classification unit.</P>
			<P>Tilera specific Suricata runmodes have been added to Suricata
			to take advantage of the combination of many core and mpipe.</P>
			<P><BR><BR>
			</P>
			<H3 CLASS="western">Suricata Operation</H3>
			<P>Internally, Suricata generally looks like the following
			diagram:</P>
			<P ALIGN=CENTER><IMG SRC="suricata_config_guide_html_m4f983d27.gif" NAME="graphics2" ALIGN=MIDDLE WIDTH=705 HEIGHT=227 BORDER=0></P>
			<P ALIGN=LEFT>However, the exact configuration of this processing
			path is determined by the Suricata runmode. Suricata on Tilera is
			generally more complex, making use of the multitude of tiles on
			the many core.</P>
			<H3 CLASS="western">Suricata runmodes for Tilera</H3>
			<P>Suricata on Tilera is executed with the –<FONT FACE="DejaVu Sans Mono, monospace"><FONT SIZE=2 STYLE="font-size: 11pt">mpipe</FONT></FONT>
			command line option.</P>
			<PRE CLASS="western" STYLE="margin-left: 0.5in; margin-bottom: 0.2in; background: #ffffff; border: 1px solid #000000; padding: 0.02in"><CODE CLASS="western">suricata -c /opt/suricata/etc/suricata.yaml --mpipe</CODE></PRE><P>
			This causes Suricata to run in either of two runmodes as
			configured in the suricata.yaml file.</P>
			<H4 CLASS="western"><BR><BR>
			</H4>
			<H4 CLASS="western">Pipelined Auto Runmode</H4>
			<P>The “auto” runmode for mpipe is chosen bu setting the
			<FONT FACE="DejaVu Sans Mono, monospace">runmode</FONT> parameter
			to <FONT FACE="DejaVu Sans Mono, monospace">auto</FONT> in
			suricata.yaml. This is the default configuration if this
			configuration is eliminated, or commented out.</P>
			<PRE CLASS="western" STYLE="margin-left: 0.5in; margin-bottom: 0.2in; background: #ffffff; border: 1px solid #000000; padding: 0.02in"><CODE CLASS="western"><FONT SIZE=2 STYLE="font-size: 9pt"># Runmode custom mode the engine should run in.  Please check –list-runmodes</FONT></CODE>
<CODE CLASS="western"><FONT SIZE=2 STYLE="font-size: 9pt"># to get the runmode custom modes that can be used here for a particular runmode.</FONT></CODE>
<CODE CLASS="western"><FONT SIZE=2 STYLE="font-size: 9pt">runmode: auto</FONT></CODE></PRE><P>
			This configuration causes Suricata to run as several parallel
			pipelines. Each individual pipeline consists of the following:</P>
			<P><BR><BR>
			</P>
			<P ALIGN=CENTER><IMG SRC="suricata_config_guide_html_mcd6413d.gif" NAME="graphics3" ALIGN=MIDDLE WIDTH=884 HEIGHT=364 BORDER=0></P>
			<P ALIGN=LEFT>In order to consume the tiles available on the
			tilegx processor several copies of the above pipeline are operated
			in parallel as depicted in the following example.</P>
			<P ALIGN=LEFT><BR><BR>
			</P>
			<H2 CLASS="western" ALIGN=CENTER><IMG SRC="suricata_config_guide_html_m5c55c881.gif" NAME="graphics4" ALIGN=MIDDLE WIDTH=681 HEIGHT=546 BORDER=0></H2>
			<H4 CLASS="western">Workers Runmode</H4>
			<P>The “workers” runmode is chosen by setting the <FONT FACE="DejaVu Sans Mono, monospace">runmode</FONT>
			parameter to <FONT FACE="DejaVu Sans Mono, monospace">workers</FONT>
			in suricata.yaml.</P>
			<PRE CLASS="western" STYLE="margin-left: 0.5in; margin-bottom: 0.2in; background: #ffffff; border: 1px solid #000000; padding: 0.02in"><CODE CLASS="western"><FONT SIZE=2 STYLE="font-size: 9pt"># Runmode custom mode the engine should run in.  Please check –list-runmodes</FONT></CODE>
<CODE CLASS="western"><FONT SIZE=2 STYLE="font-size: 9pt"># to get the runmode custom modes that can be used here for a particular runmode.</FONT></CODE>
<CODE CLASS="western"><FONT SIZE=2 STYLE="font-size: 9pt">runmode: workers</FONT></CODE></PRE><P STYLE="margin-left: 0.01in">
			This configuration causes Suricata to spawn a thread on nearly all
			of the available Tilera “dataplane” tiles. The Suricata
			processing pipeline will operate in a “run to completion” mode
			on each of these tiles. Generally the “workers” runmode
			provides the highest aggregate throughput.</P>
			<H2 CLASS="western">The suricata.yaml File</H2>
			<P>Several sections of the suricata.yaml configuration file affect
			the operation of suricata on Tilera processors.</P>
			<P>The <FONT FACE="DejaVu Sans Mono, monospace">max-pending-packets</FONT>
			setting controls the overall number of packets processed by
			Suricata at any given time. This number is useful when operating
			suricata with the PCIe packet capture feature enabled in order to
			prevent packet loss which capturing packets at speeds higher than
			the rate at which Suricata packet processing is able to sustain.</P>
			<PRE CLASS="western" STYLE="margin-left: 0.5in; margin-bottom: 0.2in; background: #ffffff; border: 1px solid #000000; padding: 0.02in"><CODE CLASS="western"><FONT SIZE=2 STYLE="font-size: 9pt"># Number of packets allowed to be processed simultaneously.  Default is a</FONT></CODE>
<CODE CLASS="western"><FONT SIZE=2 STYLE="font-size: 9pt"># conservative 50. a higher number will make sure CPU's/CPU cores will be</FONT></CODE>
<CODE CLASS="western"><FONT SIZE=2 STYLE="font-size: 9pt"># more easily kept busy, but will negatively impact caching.</FONT></CODE>
<CODE CLASS="western"><FONT SIZE=2 STYLE="font-size: 9pt">#</FONT></CODE>
<CODE CLASS="western"><FONT SIZE=2 STYLE="font-size: 9pt"># If you are using the CUDA pattern matcher (b2g_cuda below), different rules</FONT></CODE>
<CODE CLASS="western"><FONT SIZE=2 STYLE="font-size: 9pt"># apply. In that case try something like 4000 or more. This is because the CUDA</FONT></CODE>
<CODE CLASS="western"><FONT SIZE=2 STYLE="font-size: 9pt"># pattern matcher scans many packets in parallel.</FONT></CODE>
<CODE CLASS="western"><FONT SIZE=2 STYLE="font-size: 9pt">max-pending-packets: 8192</FONT></CODE></PRE><P>
			The <FONT FACE="DejaVu Sans Mono, monospace">runmode</FONT>
			configuration setting selects which runmode, <FONT FACE="DejaVu Sans Mono, monospace">workers</FONT>
			or <FONT FACE="DejaVu Sans Mono, monospace">auto</FONT> is chosen
			as described above. A typical configuration will likely choose the
			<FONT FACE="DejaVu Sans Mono, monospace">workers</FONT> runmode.</P>
			<PRE CLASS="western" STYLE="margin-left: 0.5in; margin-bottom: 0.2in; background: #ffffff; border: 1px solid #000000; padding: 0.02in"><CODE CLASS="western"><FONT SIZE=2 STYLE="font-size: 9pt"># Runmode custom mode the engine should run in.  Please check –list-runmodes</FONT></CODE>
<CODE CLASS="western"><FONT SIZE=2 STYLE="font-size: 9pt"># to get the runmode custom modes that can be used here for a particular runmode.</FONT></CODE>
<CODE CLASS="western"><FONT SIZE=2 STYLE="font-size: 9pt">runmode: workers</FONT></CODE></PRE><P>
			suricata.yaml contains two sections specific to Tilera. The <FONT FACE="DejaVu Sans Mono, monospace">mpipe:</FONT>
			section controls configuration options and tunable parameters
			specific to the mpipe packet classifier and packet distribution
			system.</P>
			<P>The <FONT FACE="DejaVu Sans Mono, monospace">tile:</FONT>
			section configures the layout of the suricata processing pipeline
			when running in the Tilera <FONT FACE="DejaVu Sans Mono, monospace">auto</FONT>
			runmode.</P>
			<P>A typical suricata.yaml will contain something similar to the
			following:</P>
			<PRE CLASS="western" STYLE="margin-left: 0.5in; margin-bottom: 0.2in; background: #ffffff; border: 1px solid #000000; padding: 0.02in"><CODE CLASS="western"><FONT SIZE=2 STYLE="font-size: 9pt"># Tilera mpipe configuration. for use on Tilera tilegx</FONT></CODE>
<CODE CLASS="western"><FONT SIZE=2 STYLE="font-size: 9pt">mpipe:</FONT></CODE>
<CODE CLASS="western"> </CODE><CODE CLASS="western"><FONT SIZE=2 STYLE="font-size: 9pt"># Load balancing mode &quot;static&quot; or &quot;dynamic&quot;.</FONT></CODE>
<CODE CLASS="western"> </CODE><CODE CLASS="western"><FONT SIZE=2 STYLE="font-size: 9pt">load-balance: dynamic</FONT></CODE>
<CODE CLASS="western"> </CODE><CODE CLASS="western"><FONT SIZE=2 STYLE="font-size: 9pt"># Enable packet capture to pcie</FONT></CODE>
<CODE CLASS="western"> </CODE><CODE CLASS="western"><FONT SIZE=2 STYLE="font-size: 9pt">capture:</FONT></CODE>
<CODE CLASS="western">   </CODE><CODE CLASS="western"><FONT SIZE=2 STYLE="font-size: 9pt">enabled: no</FONT></CODE>
<CODE CLASS="western"> </CODE><CODE CLASS="western"><FONT SIZE=2 STYLE="font-size: 9pt"># Timestamp option</FONT></CODE><CODE CLASS="western"> </CODE><CODE CLASS="western"><FONT SIZE=2 STYLE="font-size: 9pt">&quot;linux&quot; or &quot;mpipe&quot;.</FONT></CODE>
<CODE CLASS="western"> </CODE><CODE CLASS="western"><FONT SIZE=2 STYLE="font-size: 9pt">timestamp: linux</FONT></CODE>
<CODE CLASS="western"> </CODE><CODE CLASS="western"><FONT SIZE=2 STYLE="font-size: 9pt"># List of interfaces we will listen on.</FONT></CODE>
<CODE CLASS="western"> </CODE><CODE CLASS="western"><FONT SIZE=2 STYLE="font-size: 9pt">inputs:</FONT></CODE>
<CODE CLASS="western"> </CODE><CODE CLASS="western"><FONT SIZE=2 STYLE="font-size: 9pt">- interface: xgbe1</FONT></CODE>
<CODE CLASS="western"> </CODE><CODE CLASS="western"><FONT SIZE=2 STYLE="font-size: 9pt">- interface: xgbe2</FONT></CODE>
<CODE CLASS="western"> </CODE><CODE CLASS="western"><FONT SIZE=2 STYLE="font-size: 9pt">- interface: xgbe3</FONT></CODE>
<CODE CLASS="western"> </CODE><CODE CLASS="western"><FONT SIZE=2 STYLE="font-size: 9pt">- interface: xgbe4</FONT></CODE>
<CODE CLASS="western">  </CODE><CODE CLASS="western"><FONT SIZE=2 STYLE="font-size: 9pt"># packet size scale factors</FONT></CODE>
<CODE CLASS="western">  </CODE><CODE CLASS="western"><FONT SIZE=2 STYLE="font-size: 9pt">stack:</FONT></CODE>
<CODE CLASS="western">    </CODE><CODE CLASS="western"><FONT SIZE=2 STYLE="font-size: 9pt">size128: 2/16</FONT></CODE>
<CODE CLASS="western">    </CODE><CODE CLASS="western"><FONT SIZE=2 STYLE="font-size: 9pt">size256: 4/16</FONT></CODE>
<CODE CLASS="western">    </CODE><CODE CLASS="western"><FONT SIZE=2 STYLE="font-size: 9pt">size512: 0/16</FONT></CODE>
<CODE CLASS="western">    </CODE><CODE CLASS="western"><FONT SIZE=2 STYLE="font-size: 9pt">size1024: 0/16</FONT></CODE>
<CODE CLASS="western">    </CODE><CODE CLASS="western"><FONT SIZE=2 STYLE="font-size: 9pt">size1664: 9/16</FONT></CODE>
<CODE CLASS="western">    </CODE><CODE CLASS="western"><FONT SIZE=2 STYLE="font-size: 9pt">size4096: 0/16</FONT></CODE>
<CODE CLASS="western">    </CODE><CODE CLASS="western"><FONT SIZE=2 STYLE="font-size: 9pt">size10386: 1/16</FONT></CODE>
<CODE CLASS="western">    </CODE><CODE CLASS="western"><FONT SIZE=2 STYLE="font-size: 9pt">size16384: 0/16</FONT></CODE>
<CODE CLASS="western">  </CODE><CODE CLASS="western"><FONT SIZE=2 STYLE="font-size: 9pt"># number of queues to poll</FONT></CODE>
<CODE CLASS="western">  </CODE><CODE CLASS="western"><FONT SIZE=2 STYLE="font-size: 9pt">poll: 2</FONT></CODE>
<CODE CLASS="western"><FONT SIZE=2 STYLE="font-size: 9pt"># Tilera runmode configuration. for use on Tilera tilepro and tilegx</FONT></CODE>
<CODE CLASS="western"><FONT SIZE=2 STYLE="font-size: 9pt">tile:</FONT></CODE>
<CODE CLASS="western">  </CODE><CODE CLASS="western"><FONT SIZE=2 STYLE="font-size: 9pt"># Number of parallel processing pipelines</FONT></CODE>
<CODE CLASS="western">  </CODE><CODE CLASS="western"><FONT SIZE=2 STYLE="font-size: 9pt">pipelines: 6</FONT></CODE>
<CODE CLASS="western">  </CODE><CODE CLASS="western"><FONT SIZE=2 STYLE="font-size: 9pt"># Number of detect threads per pipeline</FONT></CODE>
<CODE CLASS="western">  </CODE><CODE CLASS="western"><FONT SIZE=2 STYLE="font-size: 9pt">detect-per-pipeline: 3</FONT></CODE>
<CODE CLASS="western">  </CODE><CODE CLASS="western"><FONT SIZE=2 STYLE="font-size: 9pt"># Inter-tile queueing method (&quot;simple&quot; or &quot;tmc&quot;)</FONT></CODE>
<CODE CLASS="western">  </CODE><CODE CLASS="western"><FONT SIZE=2 STYLE="font-size: 9pt">queue: simple</FONT></CODE>
<CODE CLASS="western">  </CODE><CODE CLASS="western"><FONT SIZE=2 STYLE="font-size: 9pt">mica-memcpy: no</FONT></CODE></PRE><H3 CLASS="western">
			Suricata.yaml mpipe Configuration Section</H3>
			<P>The <FONT FACE="DejaVu Sans Mono, monospace">mpipe</FONT>
			section contained in the suricata.yaml file controls suricata's
			utilization of the tilegx mpipe packet handling unit.</P>
			<H4 CLASS="western">load-balance</H4>
			<P>The <FONT FACE="DejaVu Sans Mono, monospace">load-balance</FONT>
			configuration within the mpipe section controls the packet
			distribution amongst the processing pipelines in both “<I>auto</I>”
			and “<I>workers</I>” runmodes.  Distribution of packets to
			pipelines is always done on a flow-wise basis.</P>
			<P STYLE="margin-left: 0.5in; margin-bottom: 0.2in; background: #ffffff; border: 1px solid #000000; padding: 0.02in">
			<CODE CLASS="western"><FONT SIZE=2 STYLE="font-size: 9pt"># Load
			balancing mode &quot;static&quot; or &quot;dynamic&quot;.<BR></FONT></CODE><CODE CLASS="western">
			</CODE><CODE CLASS="western"><FONT SIZE=2 STYLE="font-size: 9pt">load-balance:
			dynamic</FONT></CODE></P>
			<P>The <FONT FACE="DejaVu Sans Mono, monospace">load-balance</FONT>
			option takes either <FONT FACE="DejaVu Sans Mono, monospace">static</FONT>
			or <FONT FACE="DejaVu Sans Mono, monospace">dynamic</FONT> as a
			parameter.  The load-balance parameter picks between the “<I>fixed</I>”
			and “<I>dynamic flow affinity</I>” modes of operation of the
			mpipe load balancer.  See Section 6.2.9.4 of the <B>Tilera Tile
			Processor and I/O Device Guide, UG404</B> for a description of the
			mpipe load balancer.</P>
			<P>When <FONT FACE="DejaVu Sans Mono, monospace">load-balance</FONT>
			is configured as <FONT FACE="DejaVu Sans Mono, monospace">static</FONT>.
			 All packets belonging to a given bidirectional flow will always
			be processed by the same pipeline in “<I>auto</I>” runmode and
			the same tile in “<I>workers</I>” runmode.</P>
			<P>When <FONT FACE="DejaVu Sans Mono, monospace">load-balance</FONT>
			is configured as <FONT FACE="DejaVu Sans Mono, monospace">dynamic</FONT>.
			 All packets belonging to a given bidirectional flow will always
			be processed by a single pipeline in “<I>auto</I>” runmode or
			single tile in “<I>workers</I>” runmode.  However, after a
			flow has gone idle for some period when the flow resumes sending
			packets again it will be reassigned to the least busy pipeline or
			tile at packet arrival time.  Setting <FONT FACE="DejaVu Sans Mono, monospace">load-balance</FONT>
			to <FONT FACE="DejaVu Sans Mono, monospace">dynamic</FONT> can
			lead to better performance of suricata under many traffic
			conditions.</P>
			<H4 CLASS="western">timestamp</H4>
			<P>The <FONT FACE="DejaVu Sans Mono, monospace">timestamp</FONT>
			configuration within the mpipe section controls how suricata
			obtains packet arrival timestamps used in packet processing and
			alert generation.</P>
			<P STYLE="margin-left: 0.5in; margin-bottom: 0.2in; background: #ffffff; border: 1px solid #000000; padding: 0.02in">
			<CODE CLASS="western"><FONT SIZE=2 STYLE="font-size: 9pt">#
			Timestamp option</FONT></CODE><CODE CLASS="western"> </CODE><CODE CLASS="western"><FONT SIZE=2 STYLE="font-size: 9pt">&quot;linux&quot;
			or &quot;mpipe&quot;.<BR></FONT></CODE><CODE CLASS="western">
			</CODE><CODE CLASS="western"><FONT SIZE=2 STYLE="font-size: 9pt">timestamp:
			linux</FONT></CODE></P>
			<P>The <FONT FACE="DejaVu Sans Mono, monospace">timestamp</FONT>
			option takes either <FONT FACE="DejaVu Sans Mono, monospace">linux</FONT>
			or <FONT FACE="DejaVu Sans Mono, monospace">mpipe</FONT> as a
			parameter.</P>
			<P>When <FONT FACE="DejaVu Sans Mono, monospace">timestamp</FONT>
			is configured as <FONT FACE="DejaVu Sans Mono, monospace">linux</FONT>
			timestamps are taken from the Linux system time.</P>
			<P>When <FONT FACE="DejaVu Sans Mono, monospace">timestamp</FONT>
			is configured as <FONT FACE="DejaVu Sans Mono, monospace">mpipe</FONT>
			timestamps are taken from the tilegx mpipe hardware timestamp
			generator.  The mpipe hardware timestamp generator can be
			synchronized using IEEE 1588 Precision Time Protocol.</P>
			<H4 CLASS="western">inputs</H4>
			<P>The <FONT FACE="DejaVu Sans Mono, monospace">inputs</FONT>
			configuration section within the <FONT FACE="DejaVu Sans Mono, monospace">mpipe</FONT>
			section sets the list of one or more interfaces from which
			suricata will process arriving packets.</P>
			<PRE CLASS="western" STYLE="margin-left: 0.5in; margin-bottom: 0.2in; background: #ffffff; border: 1px solid #000000; padding: 0.02in"><CODE CLASS="western"> </CODE><CODE CLASS="western"><FONT SIZE=2 STYLE="font-size: 9pt"># List of interfaces we will listen on.<BR></FONT></CODE><CODE CLASS="western"> </CODE><CODE CLASS="western"><FONT SIZE=2 STYLE="font-size: 9pt">Inputs:<BR></FONT></CODE><CODE CLASS="western"> </CODE><CODE CLASS="western"><FONT SIZE=2 STYLE="font-size: 9pt">- interface: xgbe1<BR></FONT></CODE><CODE CLASS="western"> </CODE><CODE CLASS="western"><FONT SIZE=2 STYLE="font-size: 9pt">- interface: xgbe2<BR></FONT></CODE><CODE CLASS="western"> </CODE><CODE CLASS="western"><FONT SIZE=2 STYLE="font-size: 9pt">- interface: xgbe3<BR></FONT></CODE><CODE CLASS="western"> </CODE><CODE CLASS="western"><FONT SIZE=2 STYLE="font-size: 9pt">- interface: xgbe4</FONT></CODE></PRE><P>
			Valid 1 Gigabit Ethernet  interfaces are <I>gbe1</I>, <I>gbe2</I>,
			<I>gbe3</I> and <I>gbe4</I>.  Valid 10 Gigabit Ethernet interfaces
			are <I>xgbe1</I>, <I>xgbe2</I>, <I>xgbe3</I> and <I>xgbe4</I>.</P>
			<P>The example above shows suricata listening to all four
			available 10 Gigabit Ethernet interfaces.  However, fewer
			interfaces may be specified.   Also a combination of 1 and 10
			Gigabit Ethernet interfaces may be listed.</P>
			<H4 CLASS="western">stack</H4>
			<P>The <FONT FACE="DejaVu Sans Mono, monospace">stack</FONT>
			configuration section within the <FONT FACE="DejaVu Sans Mono, monospace">mpipe</FONT>
			section configures the amount of memory available for use as
			packet buffers of each of the individual packet sizes supported by
			mpipe. sets the list of one or more interfaces from which suricata
			will process arriving packets.  See Section 6.2.2 of the <B>Tilera
			Tile Processor and I/O Device Guide, UG404</B> for a description
			of the mpipe packet buffer management capabilities.</P>
			<PRE CLASS="western" STYLE="margin-left: 0.5in; margin-bottom: 0.2in; background: #ffffff; border: 1px solid #000000; padding: 0.02in"><CODE CLASS="western">  </CODE><CODE CLASS="western"><FONT SIZE=2 STYLE="font-size: 9pt"># packet size scale factors<BR></FONT></CODE><CODE CLASS="western"> </CODE><CODE CLASS="western"><FONT SIZE=2 STYLE="font-size: 9pt">stack:<BR></FONT></CODE><CODE CLASS="western"> </CODE><CODE CLASS="western"><FONT SIZE=2 STYLE="font-size: 9pt">size128: 2/16<BR></FONT></CODE><CODE CLASS="western"> </CODE><CODE CLASS="western"><FONT SIZE=2 STYLE="font-size: 9pt">size256: 4/16<BR></FONT></CODE><CODE CLASS="western"> </CODE><CODE CLASS="western"><FONT SIZE=2 STYLE="font-size: 9pt">size512: 0/16<BR></FONT></CODE><CODE CLASS="western"> </CODE><CODE CLASS="western"><FONT SIZE=2 STYLE="font-size: 9pt">size1024: 0/16<BR></FONT></CODE><CODE CLASS="western"> </CODE><CODE CLASS="western"><FONT SIZE=2 STYLE="font-size: 9pt">size1664: 9/16<BR></FONT></CODE><CODE CLASS="western"> </CODE><CODE CLASS="western"><FONT SIZE=2 STYLE="font-size: 9pt">size4096: 0/16<BR></FONT></CODE><CODE CLASS="western"> </CODE><CODE CLASS="western"><FONT SIZE=2 STYLE="font-size: 9pt">size10386: 1/16<BR></FONT></CODE><CODE CLASS="western"> </CODE><CODE CLASS="western"><FONT SIZE=2 STYLE="font-size: 9pt">size16384: 0/16</FONT></CODE></PRE><P>
			The <FONT FACE="DejaVu Sans Mono, monospace">stack</FONT> section
			configures the amount of memory allocated to each buffer size. 
			The size parameter is expresses as a fraction of available packet
			buffer memory.  For example, in the configuration above 9/16ths of
			the available memory will be utilized by packets up to 1664 bytes
			in length.</P>
			<H3 CLASS="western">Suricata.yaml tile Configuration Section</H3>
			<P>The <FONT FACE="DejaVu Sans Mono, monospace">tile</FONT>
			section contained in the suricata.yaml file controls suricata's
			pipeline configuration when Suricata is running in the “<I>auto</I>”
			runmode.  When suricata is running in “<I>workers</I>” runmode
			this contents of this section has no effect.</P>
			<P>Eight different packet buffer sizes are available to mpipe
			(128, 256, 512, 1024, 1664, 4096, 10368 and 16384 bytes),  
			</P>
			<H2 CLASS="western">Suricata Release 1.4 Features On Tilera</H2>
			<H3 CLASS="western">IPS and TAP Support</H3>
			<P>Suricata release 1.4 contains support for IPS and TAP
			operation. The support was implemented in a way that follows the
			model introduced for AF_PACKET IPS mode described <A HREF="https://home.regit.org/2012/09/new-af_packet-ips-mode-in-suricata/?utm_source=rss&amp;utm_medium=rss&amp;utm_campaign=new-af_packet-ips-mode-in-suricata">here.</A></P>
			<P>The IPS and TAP operating modes peer pairs of network
			interfaces and all packets received from one interface are sent to
			the other interface (if a signature with drop keyword does not
			fire on the packet). This provides a simple bridge between the
			pair of interfaces.</P>
			<P>The following configuration will configure Suricata acting as
			IPS between interface <EM>xgbe2</EM> and <EM>xgbe4</EM>:</P>
			<PRE CLASS="western" STYLE="margin-left: 0.5in; margin-bottom: 0.2in; background: #ffffff; border: 1px solid #000000; padding: 0.02in"><CODE CLASS="western"><FONT SIZE=2 STYLE="font-size: 9pt"># Tilera mpipe configuration. for use on Tilera tilegx</FONT></CODE>
<CODE CLASS="western"><FONT SIZE=2 STYLE="font-size: 9pt">mpipe:</FONT></CODE>

<CODE CLASS="western">  </CODE><CODE CLASS="western"><FONT SIZE=2 STYLE="font-size: 9pt"># Load balancing mode &quot;static&quot; or &quot;dynamic&quot;.</FONT></CODE>
<CODE CLASS="western">  </CODE><CODE CLASS="western"><FONT SIZE=2 STYLE="font-size: 9pt">load-balance: dynamic</FONT></CODE>

<CODE CLASS="western">  </CODE><CODE CLASS="western"><FONT SIZE=2 STYLE="font-size: 9pt"># List of interfaces we will listen on.</FONT></CODE>
<CODE CLASS="western">  </CODE><CODE CLASS="western"><FONT SIZE=2 STYLE="font-size: 9pt">inputs:</FONT></CODE>
<CODE CLASS="western">  </CODE><CODE CLASS="western"><FONT SIZE=2 STYLE="font-size: 9pt">- interface: xgbe2</FONT></CODE>
<CODE CLASS="western">    </CODE><CODE CLASS="western"><FONT SIZE=2 STYLE="font-size: 9pt">copy-mode: ips</FONT></CODE>
<CODE CLASS="western">    </CODE><CODE CLASS="western"><FONT SIZE=2 STYLE="font-size: 9pt">copy-iface: xgbe4</FONT></CODE>
<CODE CLASS="western">  </CODE><CODE CLASS="western"><FONT SIZE=2 STYLE="font-size: 9pt">- interface: xgbe4</FONT></CODE>
<CODE CLASS="western">    </CODE><CODE CLASS="western"><FONT SIZE=2 STYLE="font-size: 9pt">copy-mode: ips</FONT></CODE>
<CODE CLASS="western">    </CODE><CODE CLASS="western"><FONT SIZE=2 STYLE="font-size: 9pt">copy-iface: xgbe2</FONT></CODE>

<CODE CLASS="western">  </CODE><CODE CLASS="western"><FONT SIZE=2 STYLE="font-size: 9pt"># number of queues to poll</FONT></CODE>
<CODE CLASS="western">  </CODE><CODE CLASS="western"><FONT SIZE=2 STYLE="font-size: 9pt">poll: 2</FONT></CODE></PRE><P>
			Basically, we’ve got a configuration with two interfaces.
			Interface <EM>xgbe2</EM> will copy all received packets to <EM>xgbe4</EM>
			because of the <EM>copy-*</EM> configuration variable:</P>
			<PRE CLASS="western">    copy-mode: ips
    copy-iface: xgbe4</PRE><P>
			The configuration on x<EM>gbe4</EM> is symmetric:</P>
			<PRE CLASS="western">    copy-mode: ips
    copy-iface: xgbe2</PRE><P STYLE="margin-bottom: 0.2in">
			The <EM>copy-mode</EM> variable can take the following values: 
			</P>
			<UL>
				<LI><P STYLE="margin-bottom: 0in"><EM>ips</EM>: the drop keyword
				is honored and matching packet are dropped. 
				</P>
				<LI><P><EM>tap</EM>: no drop occurs, Suricata act as a bridge 
				</P>
			</UL>
			<P>Note, that mode can be different on the peered interfaces.</P>
			<P>When the <FONT FACE="DejaVu Sans Mono, monospace">ips copy-mode</FONT>
			is chosen the bridge will operate as an IPS, dropping packets that
			fire on a rule containing a drop keyword.</P>
			<P>When the <FONT FACE="DejaVu Sans Mono, monospace">tap copy-mode</FONT>
			is selected the bridge operates as an IDS operating as if it were
			attached to a tap on the bridge. A tap configuration is shown
			below.</P>
			<PRE CLASS="western" STYLE="margin-left: 0.5in; margin-bottom: 0.2in; background: #ffffff; border: 1px solid #000000; padding: 0.02in"><CODE CLASS="western"><FONT SIZE=2 STYLE="font-size: 9pt"># Tilera mpipe configuration. for use on Tilera tilegx</FONT></CODE>
<CODE CLASS="western"><FONT SIZE=2 STYLE="font-size: 9pt">mpipe:</FONT></CODE>

<CODE CLASS="western">  </CODE><CODE CLASS="western"><FONT SIZE=2 STYLE="font-size: 9pt"># Load balancing mode &quot;static&quot; or &quot;dynamic&quot;.</FONT></CODE>
<CODE CLASS="western">  </CODE><CODE CLASS="western"><FONT SIZE=2 STYLE="font-size: 9pt">load-balance: dynamic</FONT></CODE>

<CODE CLASS="western">  </CODE><CODE CLASS="western"><FONT SIZE=2 STYLE="font-size: 9pt"># List of interfaces we will listen on.</FONT></CODE>
<CODE CLASS="western">  </CODE><CODE CLASS="western"><FONT SIZE=2 STYLE="font-size: 9pt">inputs:</FONT></CODE>
<CODE CLASS="western">  </CODE><CODE CLASS="western"><FONT SIZE=2 STYLE="font-size: 9pt">- interface: xgbe2</FONT></CODE>
<CODE CLASS="western">    </CODE><CODE CLASS="western"><FONT SIZE=2 STYLE="font-size: 9pt">copy-mode: tap</FONT></CODE>
<CODE CLASS="western">    </CODE><CODE CLASS="western"><FONT SIZE=2 STYLE="font-size: 9pt">copy-iface: xgbe4</FONT></CODE>
<CODE CLASS="western">  </CODE><CODE CLASS="western"><FONT SIZE=2 STYLE="font-size: 9pt">- interface: xgbe4</FONT></CODE>
<CODE CLASS="western">    </CODE><CODE CLASS="western"><FONT SIZE=2 STYLE="font-size: 9pt">copy-mode: tap</FONT></CODE>
<CODE CLASS="western">    </CODE><CODE CLASS="western"><FONT SIZE=2 STYLE="font-size: 9pt">copy-iface: xgbe2</FONT></CODE>

<CODE CLASS="western">  </CODE><CODE CLASS="western"><FONT SIZE=2 STYLE="font-size: 9pt"># number of queues to poll</FONT></CODE>
<CODE CLASS="western">  </CODE><CODE CLASS="western"><FONT SIZE=2 STYLE="font-size: 9pt">poll: 2</FONT></CODE></PRE>
		</DIV>
	</DIV>
</DIV>
<P>Note that is possible to have normal IDS interface running
simultaneously. For example, <EM>xgbe1</EM> could be added to the
<EM><SPAN STYLE="font-variant: normal"><FONT FACE="DejaVu Sans Mono, monospace"><SPAN STYLE="font-style: normal">mpipe</SPAN></FONT></SPAN></EM>
configuration and used a IDS interface.</P>
</BODY>
</HTML>